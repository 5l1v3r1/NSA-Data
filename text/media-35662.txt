TOP SECRET STRAP1
12th November 2010

ICTR-MCT Team 

MHE Team 


TEA

Benhall Records Centre 

 

iPhone target analysis and exploitation with unique
device identifiers

Summary

This paper describes standard analysis techniques
that have been used to both discover iPhone
target end point machines and implant target
iPhones directly using the QUANTUM system. It
shows that the iPhone Unique Device Identifier
(UDID) can be used for target tracking and can be
used to correlate with end point machines and
target phone. It highlights the exploits currently
available and the CNE process to enable further
targeting.

  



  

Page 1 of 11
TOP SECRET STRAP1

TOP SECRET STRAP1
12th November 2010

A. REFERENCES

iPhone applications and privacy issues: An analysis of Application
Transmission of iPhone Unique Device Identifiers (UDIDs),
October 1 2010

CROWN PRINCE Techni ue for identifying Apple UDIDs in HTTP traffic
8/7844/5001/1/105? 22/07/10

Strategic Framework Task 4138585 Report No: Roke 
October 2009 Issue 2

The Good ienetration iuide -

[e1  SEPP  
wheelie-?

B. BACKGROUND

1. Every Apple iPhone, iPad and iPod touch has a unique hardware
identifier called the Apple UDID. The UDID is a 40 character hex string
(160 bits) that seems to be a hash of the IMEI, serial number and
the Bluetooth and WiFi MAC addresses. The UDID is available to
developers of applications for these devices, and it is used to identify a
given device. As highlighted in the UDID is seen in multiple apps and
can be used to allow target tracking or be used to correlate with other
personal identifiers.

2. The Mobile Theme has invested a large amount of research into iPhone
apps and metadata anal sis over the last year accumulating with a
detailed report done by in October 2009 and 29 SEM rules
created by ICTR-MCT These rules have used to extract iPhone
metadata for a number of apps and in particular the Unique Device
Identifier (UDID) from any carrier being processed using DEBIT CARDs.
Further TDI rules are being developed by GTE that will in the future
extract UDID events from carriers processed through the MVR system.
The resulting events have then been used to populate both research and
corporate QFDs (Query Focused Datasets) such as MUTANT BROTH
and AUTOASSOC and will eventually form the basis of mobile
correlations in HARD ASSOC.

3. Initially, an exploit was developed by the Joint Mobile
Exploitation Team for iPhone that was to be delivered to the target
phone when syncing with an exploited end point machine. This was
successful for a BROKER target and resulted in the extraction of SMS,
call logs and contact details. After this initial trial, CNE and SD undertook
work to discover other single end points seen syncing with iPhones.

4. At HANDEX 2010 (handset exploitation workshop) in August, various
aspects of the iPhone OS were investigated for potential vulnerabilities.

Page 2 of 11
TOP SECRET STRAP1

C.

TOP SECRET STRAP1
12th November 2010

Using an open source PDF vulnerability when using the Safari browser,
Joint Mobile Exploitation Team were able to develop an
exploit to deliver a WARRIORPRIDE implant to a target test phone.
Further, investigation, liaison and testing with the CNE QUANTUM team
resulted in approval for the implant to be deployed against QUANTUM
iPhone targets.

DESCRIPTION OF ANALYSIS

CNE Endpoint

As part of the SD Mobile Exploitation theme to identify further end point
machines that had been seen syncing with iPhones, a survey was
undertaken by CNE and TAO to scan all target end point machines for
the appropriate iPhone registry keys. Scanning of all CNE stored single
end point (SEPs) registry keys on particular process IDs resulted in 9
CNE endpoints seen this year sync'd with iPhones. The resulting Unique
Device Identifiers (UDID) were extracted from the registry keys and ran
in MUTANT BROTH and AUTOASSOC, resulting in 6 correlations with
either iPhone Safari user agents or the iPhone Mail app seen in passive
coHecdon.

A CNE end point operation 

EPILSON had resulted in access to a windows end point machine
. A scan of this machine's re istr keys resulted in UDID
. As can be seen, the

UDID has been seen with the Admob SEM rule type and with the Apple-
IMEI-URI TDI type. Admob is the largest mobile advertising network
allowing games publishers to embed adverts and therefore receive
revenue from a number of different brands. The target iPhone OS is 3_0
as shown in the User Agent profile in figure 2.

type value

 





HIE

EHF_Admuh-H-Admnb-I5u

Figure 1 MUTANT BROTH Matching Identifiers

I COLIN 

{93}

User-Agent

 

anillajin ?Phillie: II: CPII iPhone ['15 3_n like Mac HS 3: HIV iPhnnel,2: Ian?us) 
like Gecko} 

iPhunc Mail 

riuzillarab (iPhone: u; CPU iPhone as a, like Mac as NW nPhoneI.z: en 
(ICIITHL. like Gecko) 

Figure 2 ??iPhone UDID User agent profile

3 [13 ?1'33

11 [was 
2 {12 'er

Page 3 of 11
TOP SECRET STRAP1

TOP SECRET STRAP1
12th November 2010

7. The target UDID can be used track the iPhone seen with ASBOLINE
EPILSON end point machine. In this particular case the tar et UDID has
been seen 16 times, the last time off Pi on the
24/10/10 using the inbuilt iPhone Mail client to access his yahoo

account. The user agent for this is shown in Figure 3. In this case the
TDI rule was used to extract the specific UDID

 

value.
TDI?Scope Auto Route
User?Agent iPhone Mail 
Labelled?Ru ute
Figure 3 iPhone Mail client user agent
Bearer .5."ng E?se'g Either info
TDI-5L0: HclLilIll I: Ruute

I

Source 
at-Tranifn rm SEM- 
User?Fluent fqu-crne; CPU
iPhone 0'3 3_0 like Mai: 0'3 
iPhone'LE; Aggiei?lebKItFEZE-L?l
lile Geclt) [Adm-31::-

Labelled-Route



Figure 4 iPhone Admob user agent profile

8. The UDID for all 6 targets were run through AUTOASSOC. The result for
is shown in Figure 5. As can be seen there is a clear

correlation with the yahoo-Y-cookie.

Kno wn TDI Pu ta the CORN TH Score Events Moat

 

tasking .7 recent
Vahoo-V-Cookr'e: 0.500 1 23/08/10
Vanoo?V?Cookie: 0.500 1 14/11/09
Vahoo-V-Cookr'e: 0.500 1 14/11/09
Vahoo-V-Cookr'e: 0.500 1 19/06/10
Vahoo-V-Cookr'e: 0.500 1 10/12/09
Yehoe-Y-Coeki'e: 0.500 1 19/08/10
Vahoo-V-Cookr'e: 0.500 1 23/08/10
Vahoo-V-Cookr'e: 0.500 1 10/12/09
Vahoo?V?Cookie: 0.500 1 19/06/10
Vahoo-V-Cookr'e: 0.500 1 15/11/09
EXP_Admob-rsu-URI: EXP Admob-X-Admob-Isu: DISDD 1 19/09/10
EXP Admob-X-Admob?Isu: EXP_Admob-rsu-URI: DISDD 1 19/09/10

Figure 5 AUTOASSOC results for ABSOLINE EPSILON

9. The IP address, identifier type, bearer and user agent type for all 6
targets was extracted and formed the basis of further target development
work. Running the resulting 6 UDIDs through AUTOASSOC, resulted in
two correlations with a high enough score. These were
and and confirmed to be correct after discussing with

Page 4 of 11
TOP SECRET STRAP1

10.

11.

12.

13.

 
     
     

 

TOP SECRET STRAP1
12th November 2010

the Checking BROADOAK tasking revealed that both targets
had known associated iPhone IMEIs already tasked.

A recent rescan of all currently active CNE SEPs resulted in only 5 of the
9 identified CNE machines actually being available for exploit. The other
4 implants having been removed. Of these five UDIDs, four returned with
correlated UDIDs that had recently been seen in passive collection.
These are contained in the iPhone target list 

Analysis of all TAO SEPs resulted in 116 UDIDs being identified. Of
these UDIDs, 15 were correlated with iPhone user agents and the
resulting identifier type, project name, case notation and IP noted. A full
list is available in the iPhone target list Of these four had the Cydia
user agent as shown in Figure 6 indicating the target had jailbroken their
phone. All four end points were located in

TDI??rnpe Hanhme Rnute

Source CFC DEEIITCARZI
Format Transform SEM 
User?Agent Mozilla/5.0 Romania/2501
[ll-10006: 
AppleWebKib?ElD 13 like 
Hermon/4.0 Nubile/7011 Safari/528.16

- nH-IP-ljir-

Labelled-Hunt:

.uen .. . ream- .. .


Figure 6 iPhone jailbroken user agent in MUTANT BROTH
The same 15 TAO UDIDs were run through AUTOASSOC and resulted

in three ood correlations with yahoo selectors 
and These were in

turn confirmed to be correct correlations with TAO target end points and
two showed associated target iPhone IMEIs. Further, analysis of the
Yahoo mail used via the Safari browser clearly showed the resulting
UDID was transmitted in traffic.

One of these TAO end point machines, SOLARSHOCK116 
Iranian has been seen ncing with iPhone
UDID was correlated
with and using
AUTOASSOC. The UDID was last seen on 23/10/10 at 03:46:362 on
using the TDI.

 

 

SawFigure 7- SOLARSHOCK116 UDID AUTOASSOC correlations

Page 5 of 11
TOP SECRET STRAP1

2| 




14.

15.

24.

TOP SECRET STRAP1
12th November 2010

QUANTUM EXPLOIT

After extensive testing of the QUANTUM tipping and redirection to the
SHORTSHEET exploitation server by the Joint Mobile
Exploitation Team, further target development work was needed to
identify iPhone targets recently seen active on the appropriate user
agents. Bulk extraction of targets over a three-week period from
BLACKHOLE by ICTR resulted in a large number of iPhone targets and
further queries in Xkeyscore resulted in others. Others were passed from
discussions with various IPTs and two were also passed from TAO
contacts.

In total 44 selectors were checked to verify that the correct user agent
was present. Of these 44 selectors, 41 were yahoo selectors and 3 gmail
selectors. Of these 26 were seen with a valid iPhone Safari user agent
as shown in Figure 8. A summary of OS versions seen with target
phones is shown in Table 1 with OS highlighted in red currently
exploited. These are 3_1_2, 3_1_3 and 4_0_1. In all 26 cases, the target
were contacted with details regarding their targets use of an
exploitable iPhone.

 

 

 

 

 

 

 

 

iPhone OS Number

3_0 4
3_1 2
3_1_2 6
3_1_3 15
4_0 3
4_0_1

4_0_2 1

 

 

 

 

Table 1 iPhone target OS summary

One particular case was a target,? with yahoo
selector that was seen active on a iPhone OS

3_1_2, as shown in Figure 8. The resulting Yahoo-B cookie is

and as can be seen the target has been active off
. Running the resulting Yahoo-
cookie through MUTANT BROTH resulted in 171 events primarily on
case notations GWUKGOO5, GWVC8003 and IRUKC036. The resulting
information was then forwarded to the in the -team for
tasking by the standard CNE process as outlined in the Good
Penetration Guide 

 
 

Page 6 of 11
TOP SECRET STRAP1

25.

26.

27.

28.

29.

TOP SECRET STRAP1
12th November 2010

     
 

Source run -
CPIJ iPhone 05 3_1_2 like MaiYohoo-B-Eookic 

- I a so 
Event-ESL. Stream-ESL 
TDI-Scope Machine Route Source Format-Transform 'I'ahoo-B-Eookie Tahoo-F-Cnokie

leer?Agent Murillo/5.0 [iPhone; ll; iPhone 03 3_1_2 like Mac OS en?us] like Gecko] 
Safari/525.16 no, MATCH ns?lP?ost-Labelled?Ruuie Event?col. Stream-ESL EFEITCB
TDI?Scope Machine Route?User?Agent Mozilla/5.0 (iPhone; u; CPU IPhone es '3 1 2 like Mai: 09 en?osi like

Gecko} version-?40 r-iobilefmn Sofaru??zaio Yahoo?T?Lookie
NH 

 

ou .
gent (iPhone;

  


Yahoo?T?Eoukie-l?ull 
Evolil-socuritr-Io?lel Elroarn-oocuritr-Iabol 

User Route [liar-Agent Mozillar'E .0 (Moons, CPU iPhone OS 3_1_2 like Mai: 05 x; err-us} like

Gecko} tiers-owe .0 Mobile/T011 Safer'v'?EEIJb Yahoo-f-cookie-Yahoo-?-Eookie Tahoo-T-Lookie
I nFFHiTn?wrnr-rumt?.

Figure 8 ?Valid iPhone Safari user agent in MB 

was seen active on different iPhone OS
and more recently on an iPad. Three other targets were seen active on
iPads and two others on iPods but with no other associated iPhone
device. Of the 44 targets seen, 16 were seen using the iPhone Mail
client that comes by default with all OS. A total of 7 targets were seen
using the Yahoo Mobile Messenger app.

The target with target selector

For all target selectors seen with valid Safari user-agents, further
MUTANT BROTH, AUTOASSOC and MARINA queries were performed
to discover any other possible OS versions seen with the selector.
MARINA profile queries were performed resulting in the OS version
being returned within the MachinelD field. The resulting user-agents,
time/date, bearer, IP and any other associated selectors are shown in
the iPhone target list Associated selectors are either from MUTANT
BROTH, AUTOASSOC or seen directly as stated in BROADOAK. All
Yahoo B-cookies as shown in Figure 8 were run in MUTANT BROTH to
confirm their uniqueness with the iPhone and target yahoo selectors.

OPERATIONAL OUTCOME

The QUANTUM redirect and PDF Safari browser exploit was developed
to work against 3_1_2, 3_1_3 and 4_0_1 Safari OS versions. Of the 26
targets seen with valid exploitable OS version, 5 were added to the
QUANTUM system for targetting.

Once notified, GCHQ IPTs either added the target to existing CNE
section 7 warrants as defined in or developed targetting aids as
defined in and wrote the appropriate warrant. The resulting section 7
warrants were approved by IPT team leaders and signed off by the CNE
Legal Team. Three NSA targets were discovered and were added by
CNE Legal Team to the Partner Agreement Forms to allow exploitation.

Initially,?yahoo sele and B-

ctor
cookie was put on cover on 

active recently on a iPhone Safari browser to access his yahoo account,
preferring instead to use the inbuilt iPhone Mail client or his iPad. Three
QUANTUM attempts resulted in no redirect to SHORTSHEET server for

Page 7 of 11
TOP SECRET STRAP1

30.

31.

32.

33.

34.

35.

TOP SECRET STRAP1
12th November 2010

- and after further analysis it was discovered that this selector was
not-but an associate. It was removed from tasking.

Target analysis and warrant was completed for a further five targets and
a successful QUANTUM redirect and the PDF exploit was delivered for
PFVT658) on the 30th of October. The resulting
WARRIORPRIDE install was also performed and beaconed on the 2nd of
November. The target phone was shown to be jailbroken and on the 3rd
of November content was successfully extracted from the phone and
was available in Looking Glass. This is highlighted in Appendix with
the resulting iPhone directory structure presented how it appears in
Looking Glass. The WARRIORPRIDE exploit has resulted in extraction
of the target?s address book, sms, call logs, notes, WLAN logs,
bookmarks, map query history, Safari browsing history and some
images. Detailed analysis of extracted files will be covered in a further
report.

A successful redirect to in October was
performed but due to what is believed to be Javascript being disabled on
the phone the firmware type of the phone could not be confirmed to
enable the first stage implant. This initial survey of the firmware type has
now been removed after discussions within CNE but the target has not
been seen recently on his iPhone for exploitation. The two other targets
tasked for QUANTUM have failed to be seen recently in collect.

Currently, there are four CNE Single End Point machines that have been
identified with recently sync?d iPhone targets. The most recent being an
OVERLIT target seen on 29/09/10. These targets are being monitored
by CNE and will have the SLIDE exploit installed to allow implant of
WARRIORPRIDE when the iPhone is sync?d with the existing SEP
machine.

CONCLUSION

With the analysis of the UDIDs on target machines and correlation in
passive collection with known target yahoo selectors, the UDID can be
used to correlate iPhone handset to end point machine and tasked
yahoo selectors. The UDID can be used for realtime tracking of target
iPhones and could in theory be used as a selector for QUANTUM events
where other traditional selectors (yahoo-Y/B cookie etc) are not present.
Of course an exploit for the application would have to be written which is
not trivial.

It is not possible at this time to take the UDID and reverse engineer the
SHA-1 HASH to discover the IMEI, MAC addresses and serial number.

Further work is ongoing to identify targets of interest that are suitable for
the QUANTUM exploitation. Development and monitoring of current

identified tar ets is still being done. Discovery of an associated IMEI for
i will help in firmware identification and exploitation of this
target.

Page 8 of 11
TOP SECRET STRAP1

36.

37.

38.

39.

40.

TOP SECRET STRAP1
12th November 2010

CNE are now conducting surveys of all target machines registry
keys for iPhone UDIDs. A similar tipping mechanism for all BROADOAK
hits needs to be completed using a XKS workflow. Hopefully, other
targets will be added for QUANTUM exploitation or discovered on new
CNE SEPs in the future and a successful exploit of a target phone
performed.

FURTHER WORK

Analysis of three PRESTON accesses has resulted in the identification
of a number of iPhone targets. Development work against at least three
target sets is needed with extraction of appropriate UDIDs and iTunes
XDSID values. Suitable section 5 warrants need to be in place to pursue
these end point machines, once CNE have gained access and the
resulting target iPhones have been discovered.

With further work being undertaken by B88 and TECA on the
WHIPSAW redirect and exploitation server, it should be possible in the
coming months to implant directly the target iPhone. However, the
WHIPSAW exploit is only available via the tasked ADSL line.

An automatic implantation of SLIDE on to an iPhone is needed.
Currently this is manual process requiring a CNE operator to be
connected to the endpoint machine whilst the target is syncing the end
point machine and iPhone.

A larger number of iPhone TDIs need to be written to allow further
events to be populated into the QFDs allowing correlations with other
target selectors. This will also enable further real-time tracking of target
identifiers.

Page 9 of 11
TOP SECRET STRAP1

TOP SECRET STRAP1
12th November 2010

APPENDIX A

Targeting aid

 

IMEI for target selector 
active and an iPhone?

 

C2C target selector 
yahoo, gmail, hotmail, UDID

 

 

 

   

Telephony selector seen
correlated in MARINA,
SOCIAL ANTHROPOID
or 

  
      

Unlikely due to the lack of
correlated mobile bearer collect
but worth checking

 

 

 

 

C2C target selector active on
any iPhone user agent?

 

 

 

 

MozilIa/5.0 (iPhone; 
CPU iPhone 08
Target high enough priority

for CNE End Point op?
Discuss with Team Leadej

 

 

and Tech Ex

 

 

Put together CNE 11HSEP Targeting 



Tech Ex QC and draft section
7 warrant or add to existing



Email pack to CNESEPP iPhone OS 3_1_2, 3_1_3, 4_0_1
then add to QUANTUM

End Point OP check for UDID
in any registry keys

 

 

Must have appropriate bearers on cover

 

 

 

 

 

 

SLIDE run and WARRIOR PRIDE
installed on handset

 

 

Page 10 of 11
TOP SECRET STRAP1

TOP SECRET STRAP1
12?? November 2010

APPENDIX 

Looking Glass iPhone directory structure

12>_ 33
File Browser



 

heme Size File Type MuJilieiJ
I ccm.q3plc.outowal<e.pli5t 504.00  .. 01-Jan-1300 00:
20.22KE PLIST File  \librar'zlpreFerencesl. .. 03-Nov-2010 
- :1 rrm..=finl1=.wiF .nlisl' 15.01KF Pl File  'Llihrarv'tnreFerenres't. .. 
bin 1.35K8  'tlibrar'r'tbreferences'l. .. 01-Jan-1300 00:
day preferencasdist 16. PLIST File  .. 03-Nov-2010 
library

- L: pre:erences
L: syszemcon?guration
- 1: private

var

 


L: aDEleDlD

apcleusbclevice

aucio

canes

carrier bundles
coreservlces
 dotaclossmigi'otoi's

.1



extensions

Filesysl'ems

fon:s

framework

internet plug-ins

keyboa'clclictionaries

launchcaemons

locleclown
 







mediacaptLre

nrezerenrehi Inrlles
Drivatelrarreworks

searchbuncles


sys:emconl'iguration
tex:lnput

videoclccoclei's



.1

?t videoencoclers


bin

sbin
var

mobile

returned files

610113.101 :3
File Searcher

Sel 
MJdFicatiJn time Creation time Accessed time Files 3.e:rieved

defaJlt defaut: defath: 

after 1111:1200: 3 after 111.112030 2 after 11111.'2c0c afber

Ilnl'n 1111-12010 a mum 111112010 3 ?pm 11111,'2r1r 3 mm
Fie Size (11 ii all/paiL ul 
deFaL/t: lgcarch
m'n 0 513989? Path: 5:10 019(5) Found

may. 9007199254340991

Warning: Maximum scorch
I':5ult reached (500).
Try a ino'e 5p:ci:ic search

 

 

 

        

 

 

 

     

 

 

 

    

 

 

 

 

\ch 11!: fig: File Typ: 1 MJiJlieiJ DaLe C'eaLeJ ReinveiJ
aclcressbook.soltedb l_ 236.0K8  31-Jan-1800 31-Jan-1830 RECEIVED 02/11/1013:06
cdci'essbook.sqltedb 206.0103 \ci'ivotch'oi'imoblelji. .. 31-Jcn-1000 00: . 31-Jan-1030 0E: . .. RECEIVED 02/11/10 16:06
51115.03 88.0KB  31-Jan-1800 00: . 31-Jan-1830 RECEIV 02,111,110 13:06
srns.d:i 88.0KB  \crivatelvarimoblelJi. .. 31-Jan-1800 0 . 31-Jan-1830 RECEI 02/11/10 16:36
Le ILer .pli:L 134.08  .. 31-Jci 1-1000 0 RECEI 02/11/10 10:06
oom.ajpe.:omrrce1ter.plist 134.08  31-Jan-18000 . 31-Jan-1830 0E RECEIV. 02,111/10 16:36
14.9KB  \librar'zlprezererc . . 31-Jan-1830 0E RECEI 03/11/10 17:12
oomajpewl?plst 15.01103 PLIST File  RECEI 03,111,110 1?:11
l_ 1.23<8  31-Jan-1800 00: . 31-Jan-1830 RECEI 02/11/1013:06
1.23<8  \vorimobiclibrorylp? 31 1800 00: . 31 Jan 1830 RECEIV 02/11/10 16:36
166.08  UU: . 02,111,110 13:01:
com.c?DDe.Voutube.Dist l_ 166.08  'tvartmobie'library'lnn . 31-Jan-1830 RECEIVE 02/11/10 16:36
\lyo'lmobileilitra'yl. .. . 31-Jan-1030 0E RECEIVED 02/11/10 10:06
com.appe.accountsettirgs.plst 
oom.q3pe.nq3s.plist 1.12(.8  02/11/10 13:06
Iqu>.plbL 1.1ZKB  . . 31-Jai 1-1030 0E 02/11/10 16:06
100.08  . 31-Jan-1830 02,111/10 13:06
oom.q3pe.3reFerences.datet me.clist 100.08 \varimobielibrarylp? 31-J=n-1800 00: . 31-Jan-1830 0E: . .. RECEIVED 02/11/10 16:36
1.0118  Ivartmobletlbrarytp? Juan-1600 00: . Juan-1630 02,111,11016:36
l_ 88.08  31-Jan-18000 . 31-Jan-1830 02/11/1013:06
1.0K8  31 18000 02/11/10 13:06
8818  Ivartmobletibrarytp? . UL 02,111,110 16:31:
0.08  31-?an-18000 . . 31-?lan-1830 0F 02/11/10 13:06
cr-dynonic-text 2.41K0 \lyo'lmobileilitra'yl. .. 31-Jcn-1000 00: . 31-Jan-1030 0E: . .. 02/11/10 10:06
ar-dynanic-textclat 2.41K8  31-Jan-1800 00: . 31-Jan-1830 
cyramic-tectdat 18.9318 \lda'lmobileilitra'yl. .. 31-Jan-1800 00: . 31-Jan-1830 0E: . .. 02/11/10 13:06
Lyi 16.9613 31-Jci 1-1000 00: . 31-Jai 1-1030 0E: . .. 02/11/10 16:06
1?0.08  31-Jan-1800 00: . 31-Jan-1830 
rotes cll: 32.0KB \lva'lmobileilitra'yl. .. 31-Jan-1800 0 . 31-Jan-1830 0E 02/11/10 13:06
170.08  Juan-16000 . . 02,111,11016:36
rotas cll: l_ 32.0(8  'tvartmobie'library'tnn 31-Jan-1800 0 02/11/10 16:36
143(8  31 18000  02/11/10 13:06

     

Page 11 of 11
TOP SECRET STRAP1

